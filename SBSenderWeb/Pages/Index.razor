@page "/"
@using SBShared.Models
@using SBSenderWeb.Services
@using System.ComponentModel.DataAnnotations
@inject IQueueService _queue

<h1>Person Queue</h1>

<form @onsubmit="PublishMessage">
    <div class="form-group">
        <label>Enter the amount of data you want to send to the Queue</label>
        <input class="form-control"
               required
               type="number"
               min="1"
               @bind="@amountOfData" />
    </div>
    <button type="submit" class="btn btn-primary" disabled="@disableSubmit">Submit</button>

</form>
<br>
@if (people == null || !people.Any())
{
    <p><em>No data to send...</em></p>
}
else
{
    <table class="table">
        <thead>
        <tr>
            <th>FirstName</th>
            <th>LastName</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var forecast in people)
        {
            <tr>
                <td>@forecast.FirstName</td>
                <td>@forecast.LastName</td>
            </tr>
        }
        </tbody>
    </table>
}

@code
{
    [Required]
    private int amountOfData = 0;
    private readonly List<PersonModel> people = new List<PersonModel>();
    private bool disableSubmit = false;
    private async Task PublishMessage()
    {
        people.Clear();
        disableSubmit = true;
        for (var i = 0; i < amountOfData; i++)
        {
            var person = new PersonModel(Faker.Name.First(), Faker.Name.Last());
            people.Add(person);
        }

        await _queue.SendMessagesAsync(people, "personqueue");

        disableSubmit = false;
    }
}